TCP គឺជាពិធីការមួយក្នុងចំណោមពិធីការសំខាន់ៗបំផុតនៃ Internet Protocols។ វាជាពិធីការដែលត្រូវបានប្រើប្រាស់យ៉ាងទូលំទូលាយសម្រាប់ការបញ្ជូនទិន្នន័យក្នុងបណ្តាញទំនាក់ទំនងដូចជា Internet។

# Features
---
- TCP គឺជាពិធីការដែលអាចទុកចិត្តបាន។ មានន័យថា អ្នកទទួលតែងតែផ្ញើការបញ្ជាក់វិជ្ជមាន ឬ អវិជ្ជមានអំពីកញ្ចប់ទិន្នន័យទៅកាន់អ្នកផ្ញើ ដូច្នេះអ្នកផ្ញើតែងតែដឹងច្បាស់ថាតើកញ្ចប់ទិន្នន័យបានទៅដល់គោលដៅឬត្រូវផ្ញើម្តងទៀត។

- TCP ធានាថាទិន្នន័យទៅដល់គោលដៅដែលចង់បានតាមលំដាប់លំដោយដែលវាត្រូវបានផ្ញើ។

- TCP ផ្តោតលើការតភ្ជាប់។ TCP តម្រូវឱ្យមានការតភ្ជាប់រវាងចំណុចចម្ងាយពីរត្រូវបានបង្កើតឡើងមុនពេលផ្ញើទិន្នន័យជាក់ស្តែង។

- TCP ផ្តល់នូវយន្តការត្រួតពិនិត្យកំហុស និងការស្តារឡើងវិញ។

- TCP ផ្តល់នូវការទំនាក់ទំនងពីចុងដល់ចុង។

- TCP ផ្តល់នូវការគ្រប់គ្រងលំហូរ និងគុណភាពសេវាកម្ម។

- TCP ដំណើរការក្នុងទម្រង់ Client/Server ពីចំណុចទៅចំណុច។

- TCP ផ្តល់នូវម៉ាស៊ីនបម្រើ full duplex មានន័យថាវាអាចបំពេញតួនាទីទាំងអ្នកទទួល និងអ្នកផ្ញើ។

# Header
---
ប្រវែងនៃ TCP header គឺអប្បបរមា 20 bytes និងអតិបរមា 60 bytes។

![[Pasted image 20250201205540.png]]

- **Source Port (16-bits)**: វាកំណត់អត្តសញ្ញាណ port នៃដំណើរការកម្មវិធីនៅលើឧបករណ៍ផ្ញើ។

- **Destination Port (16-bits)**: វាកំណត់អត្តសញ្ញាណ port នៃដំណើរការកម្មវិធីនៅលើឧបករណ៍ទទួល។

- **Sequence Number (32-bits)**: លេខលំដាប់នៃបៃទិន្នន័យក្នុង segment ក្នុងវគ្គមួយ។

- **Acknowledgement Number (32-bits)**: នៅពេល ACK flag ត្រូវបានកំណត់ លេខនេះមានលេខលំដាប់បន្ទាប់នៃបៃទិន្នន័យដែលរំពឹងទុក និងដំណើរការជាការទទួលស្គាល់ទិន្នន័យមុនដែលបានទទួល។

* **Data Offset (4-bits)**: វាលនេះបង្ហាញពីទំហំ TCP header (32-bit words) និងការប្តូរទីតាំងទិន្នន័យនៅក្នុងកញ្ចប់ TCP បច្ចុប្បន្ន។

-  **Reserved (3-bits)**: ទុកសម្រាប់ប្រើប្រាស់នាពេលអនាគត ហើយត្រូវបានកំណត់ទៅជាសូន្យតាមលំនាំដើម។

-  **Flags (1-bit each)**:

	-  **NS**៖ Nonce Sum bit ត្រូវបានប្រើដោយ Explicit Congestion Notification signaling process។

	- **CWR**៖ នៅពេលម៉ាស៊ីនទទួលបានកញ្ចប់ដែលមាន ECE bit កំណត់ វាកំណត់ Congestion Windows Reduced ដើម្បីទទួលស្គាល់ថា ECE បានទទួល។

	- **ECE**៖ វាមានអត្ថន័យពីរ៖
		  - បើ SYN bit កំណត់ទៅ 0 នោះ ECE មានន័យថា IP packet មាន CE (congestion experience) bit កំណត់។
		  - បើ SYN bit កំណត់ទៅ 1 នោះ ECE មានន័យថាឧបករណ៍គឺ ECT capable។

	- **URG**: វាបង្ហាញថា Urgent Pointer field មានទិន្នន័យសំខាន់និងគួរតែត្រូវបានដំណើរការ។

	- **ACK**: វាបង្ហាញថា Acknowledgement field មានសារៈសំខាន់។ បើ ACK ត្រូវបានសម្អាតទៅ 0 វាបង្ហាញថាកញ្ចប់មិនមានការទទួលស្គាល់។

	- **PSH**: នៅពេលកំណត់ វាជាសំណើទៅកាន់ស្ថានីយ៍ទទួលដើម្បី PUSH ទិន្នន័យភ្លាមៗនៅពេលវាមកដល់កម្មវិធីទទួលដោយមិនចាំបាច់ buffer វា។

	- **RST**: Reset flag មានលក្ខណៈដូចខាងក្រោម៖
		  - វាត្រូវបានប្រើដើម្បីបដិសេធការតភ្ជាប់ដែលកំពុងចូល។
		  - វាត្រូវបានប្រើដើម្បីបដិសេធ segment មួយ។
		  - វាត្រូវបានប្រើដើម្បីចាប់ផ្តើមការតភ្ជាប់ឡើងវិញ។

	- **SYN**: ទង់នេះត្រូវបានប្រើដើម្បីបង្កើតការតភ្ជាប់រវាងម៉ាស៊ីន។

	- **FIN**: ទង់នេះត្រូវបានប្រើដើម្បីបញ្ចប់ការតភ្ជាប់ហើយគ្មានទិន្នន័យត្រូវបានផ្លាស់ប្តូរបន្ទាប់ពីនេះទៀតទេ។ ដោយសារកញ្ចប់ជាមួយទង់ SYN និង FIN មានលេខលំដាប់ ពួកវាត្រូវបានដំណើរការតាមលំដាប់ត្រឹមត្រូវ។

- Windows Size: វាលនេះត្រូវបានប្រើសម្រាប់ការគ្រប់គ្រងលំហូររវាងស្ថានីយ៍ពីរ និងបង្ហាញពីបរិមាណ buffer (គិតជា bytes) ដែលអ្នកទទួលបានបម្រុងទុកសម្រាប់ segment មួយ។

- Checksum: វាលនេះមាន checksum នៃ Header, Data និង Pseudo Headers។

-  Urgent Pointer: វាចង្អុលទៅកាន់ byte ទិន្នន័យបន្ទាន់បើទង់ URG ត្រូវបានកំណត់ទៅ 1។

- Options: វាសម្រួលដល់ជម្រើសបន្ថែមដែលមិនត្រូវបានគ្របដណ្តប់ដោយ header ធម្មតា។ វាល Option ត្រូវបានពណ៌នាជានិច្ចក្នុង 32-bit words។ បើវាលនេះមានទិន្នន័យតិចជាង 32-bit ការបំពេញត្រូវបានប្រើដើម្បីគ្របដណ្តប់ bits ដែលនៅសល់ដើម្បីឈានដល់ព្រំដែន 32-bit។

# Addressing
---
ការទំនាក់ទំនង TCP រវាងម៉ាស៊ីនចម្ងាយពីរត្រូវបានធ្វើឡើងតាមរយៈលេខច្រក (TSAPs)។ លេខច្រកមានចន្លោះពី 0 - 65535 ដែលត្រូវបានបែងចែកជា៖
- System Ports (0 - 1023)
- User Ports (1024 - 49151)
- Private/Dynamic Ports (49152 - 65535)

# Connection Management
---
ការទំនាក់ទំនង TCP ដំណើរការក្នុងម៉ូដែល Server/Client។ client ផ្តើមការតភ្ជាប់ហើយ server ទទួលយកឬបដិសេធវា។ Three-way handshaking ត្រូវបានប្រើសម្រាប់ការគ្រប់គ្រងការតភ្ជាប់។

![[Pasted image 20250201210319.png]]

## Establishment
Client ចាប់ផ្តើមការតភ្ជាប់ និងផ្ញើ segment ជាមួយនឹងលេខ Sequence។ Server ឆ្លើយតបត្រឡប់មកវិញជាមួយនឹងលេខ Sequence របស់ខ្លួន និង ACK នៃ segment របស់ Client ដែលមានលេខច្រើនជាងលេខ Sequence របស់ Client មួយ។ Client បន្ទាប់ពីទទួលបាន ACK នៃ segment របស់ខ្លួន នឹងផ្ញើការទទួលស្គាល់នៃការឆ្លើយតបរបស់ Server។

## Release
Server ឬ Client អាចផ្ញើ TCP segment ជាមួយនឹង FIN flag កំណត់ទៅជា 1។ នៅពេលដែលភាគីទទួលឆ្លើយតបវិញដោយផ្ញើ ACK ទៅ FIN នោះទិសដៅនៃការទំនាក់ទំនង TCP ត្រូវបានបិទ និងការតភ្ជាប់ត្រូវបានបញ្ចប់។

## Bandwidth Management
TCP ប្រើប្រាស់គោលការណ៍នៃ window size ដើម្បីសម្របសម្រួលតម្រូវការនៃការគ្រប់គ្រងតម្រូវការបណ្តាញ។ Window size គឺជាចំនួនទិន្នន័យជា byte ដែលអ្នកផ្ញើនៅចុងបញ្ចប់អាចផ្ញើ និងចំនួនទិន្នន័យជា byte segments ដែលអ្នកទទួលអាចទទួលបាននៅពេលនោះ។ TCP ប្រើដំណាក់កាលចាប់ផ្តើមយឺតដោយប្រើ window size 1 និងបង្កើន window size ជាទ្វេដងបន្ទាប់ពីការទំនាក់ទំនងជោគជ័យនីមួយៗ។

ឧទាហរណ៍៖ client ប្រើ windows size 2 និងផ្ញើទិន្នន័យ 2 bytes។ នៅពេលទទួលបានការទទួលស្គាល់នៃ segment នេះ windows size ត្រូវបានបង្កើនទ្វេដងទៅ 4 និងបន្ទាប់មក...

ចំណែកដែលផ្ញើនឹងមាន data bytes ចំនួន ៤។ នៅពេលដែល acknowledgement នៃ ៤-byte data segment ត្រូវបានទទួល window size នឹងកើនឡើងដល់ ៨ និងបន្តទៅទៀត។

ប្រសិនបើ acknowledgement បាត់បង់ មានន័យថាទិន្នន័យបាត់បង់នៅក្នុងបណ្តាញ ឬទទួលបាន NACK នោះ window size នឹងត្រូវកាត់បន្ថយពាក់កណ្តាល ហើយដំណាក់កាល slow start នឹងចាប់ផ្តើមឡើងវិញ។

# Error Control and Flow Control
---
TCP ប្រើប្រាស់ port numbers ដើម្បីដឹងថាវាត្រូវបញ្ជូនទិន្នន័យទៅកាន់ដំណើរការកម្មវិធីណាមួយ។ ជាមួយនឹងការនេះ sequence numbers ត្រូវបានប្រើដើម្បីធ្វើសមកាលកម្មជាមួយ remote host។ រាល់ data segments ទាំងអស់ត្រូវបានផ្ញើនិងទទួលជាមួយនឹង sequence numbers។ Sender ដឹងថា data segment ណាមួយត្រូវបានទទួលដោយ receiver នៅពេលដែលវាទទួលបាន ACK។ Receiver ដឹងអំពី last segment ដែលបានផ្ញើដោយ sender ដោយយោងទៅលេខ sequence នៃកញ្ចប់ដែលទើបទទួលបាន។

ប្រសិនបើលេខ sequence នៃកញ្ចប់ដែលទើបទទួលបានមិនត្រូវគ្នាជាមួយនឹងលេខ sequence ដែល receiver រំពឹងទុក នោះវានឹងត្រូវបោះបង់ចោល ហើយ NACK នឹងត្រូវផ្ញើត្រឡប់ទៅវិញ។ ប្រសិនបើកញ្ចប់ពីរមកដល់ជាមួយនឹងលេខ sequence ដូចគ្នា TCP timestamp នឹងត្រូវបានប្រើប្រាស់ដើម្បីធ្វើការសម្រេចចិត្ត។

# Multiplexing
---
បច្ចេកទេសក្នុងការបញ្ចូល data streams ពីរឬច្រើនក្នុងមួយ session ត្រូវបានហៅថា Multiplexing។ នៅពេលដែល TCP client ចាប់ផ្តើមការតភ្ជាប់ជាមួយ Server វាតែងតែយោងទៅ well-defined port number ដែលបង្ហាញពីដំណើរការកម្មវិធី។ TCP client ប្រើប្រាស់លេខ port ចៃដន្យពី private port number pools។

ការប្រើប្រាស់ TCP Multiplexing កម្មវិធីអាចទំនាក់ទំនងជាមួយនឹងដំណើរការកម្មវិធីផ្សេងៗគ្នាជាច្រើនក្នុងមួយ session។ ឧទាហរណ៍ អតិថិជនស្នើសុំ web page ដែលបន្ទាប់មកបង្កើតការស្នើសុំផ្សេងៗគ្នានៃទិន្នន័យ (HTTP, SMTP, FTP ។ល។) TCP session timeout ត្រូវបានបង្កើន ហើយ session ត្រូវបានរក្សាទុកឱ្យបើកយូរជាងមុនដើម្បីឱ្យការចាប់ដៃបីដងអាចត្រូវបានជៀសវាង។

នេះអនុញ្ញាតឱ្យប្រព័ន្ធអតិថិជនទទួលបានការតភ្ជាប់ច្រើនលើការតភ្ជាប់និម្មិតតែមួយ។ ការតភ្ជាប់និម្មិតទាំងនេះមិនល្អសម្រាប់ Servers ទេប្រសិនបើវាបើកទុកយូរពេក។

# Congestion Control
---
នៅពេលដែលបរិមាណទិន្នន័យដែលបញ្ចូលទៅក្នុងប្រព័ន្ធលើសពីសមត្ថភាពដែលអាចដំណើរការបាន congestion កើតឡើង។ TCP គ្រប់គ្រងការកកស្ទះតាមរយៈយន្តការ Window mechanism។ TCP កំណត់ window size ដែលប្រាប់ភាគីម្ខាងទៀតថាត្រូវផ្ញើ data segment ប៉ុន្មាន។ TCP មានអាល់ករីតឹមសម្រាប់ congestion ដែលមាន៖

- Additive increase, Multiplicative Decrease
- Slow Start
- Timeout React

# Timer Management
---
TCP ប្រើប្រាស់ Timer ផ្សេងៗគ្នាដើម្បីត្រួតពិនិត្យ និងគ្រប់គ្រងកិច្ចការផ្សេងៗ៖

## Keep-alive timer:
- Timer នេះត្រូវបានប្រើដើម្បីពិនិត្យមើលភាពត្រឹមត្រូវ និងសុពលភាពនៃការតភ្ជាប់។
- នៅពេលដែល keep-alive time អស់សុពលភាព host នឹងផ្ញើ probe ដើម្បីពិនិត្យមើលថាតើការតភ្ជាប់នៅមានដែរឬទេ។

## Retransmission timer:
- Timer នេះរក្សាទុកនូវ stateful session នៃទិន្នន័យដែលបានផ្ញើ។
- ប្រសិនបើការទទួលស្គាល់នៃទិន្នន័យដែលបានផ្ញើមិនទទួលបានក្នុងរយៈពេល Retransmission time ទិន្នន័យនោះនឹងត្រូវផ្ញើម្តងទៀត។

## Persist timer:
- TCP session អាចត្រូវបានផ្អាកដោយ host ណាមួយដោយការផ្ញើ Window Size 0។
- ដើម្បីបន្ត session host ត្រូវផ្ញើ Window Size ជាមួយនឹងតម្លៃធំជាងមុន។
- ប្រសិនបើ segment មិនដល់ចុងម្ខាងទៀត ចុងទាំងពីរអាចរង់ចាំគ្នាទៅវិញទៅមកដោយគ្មានពេលកំណត់។
- នៅពេល Persist timer អស់សុពលភាព host នឹងផ្ញើ window size របស់ខ្លួនម្តងទៀតដើម្បីឱ្យចុងម្ខាងទៀតដឹង។
- Persist Timer ជួយជៀសវាង deadlocks ក្នុងការទំនាក់ទំនង។

## Timed-Wait:
- បន្ទាប់ពីបញ្ចប់ការតភ្ជាប់ host ណាមួយនឹងរង់ចាំរយៈពេល Timed-Wait ដើម្បីបញ្ចប់ការតភ្ជាប់ឱ្យបានពេញលេញ។
- នេះគឺដើម្បីធានាថាចុងម្ខាងទៀតបានទទួលការទទួលស្គាល់នៃសំណើបញ្ចប់ការតភ្ជាប់របស់ខ្លួន។
- Timed-out អាចមានរយៈពេលអតិបរមា 240 វិនាទី (4 នាទី)។

# Crash Recovery
---
TCP គឺជា reliable protocol។ វាផ្តល់នូវលេខលំដាប់ទៅឱ្យ byte នីមួយៗដែលបានផ្ញើក្នុង segment។ វាផ្តល់នូវយន្តការ feedback ពោលគឺនៅពេល host ទទួលបាន packet វាត្រូវតែឆ្លើយតបទៅ host ដែលផ្ញើជាមួយនឹងលេខលំដាប់បន្ទាប់ដែលរំពឹងទុក (ប្រសិនបើវាមិនមែនជា last segment)។

នៅពេលដែល TCP Server ដាច់ការតភ្ជាប់ពាក់កណ្តាលនៃការទំនាក់ទំនង និងចាប់ផ្តើមដំណើរការឡើងវិញ វានឹងផ្ញើ TPDU broadcast ទៅកាន់ hosts ទាំងអស់របស់វា។ បន្ទាប់មក hosts ទាំងនោះអាចផ្ញើ data segment ចុងក្រោយដែលមិនទាន់បានទទួលស្គាល់ និងបន្តដំណើរការទៅមុខទៀត។
